import sqlite3
import csv

conn = sqlite3.connect("hospital_management.db")
cursor = conn.cursor()

tables = [
    "Patient",
    "Department",
    "Doctor",
    "Appointment",
    "Prescription",
    "Billing"
]


# Function: Export Table to CSV

def export_to_csv(table_name):
    cursor.execute(f"SELECT * FROM {table_name}")
    rows = cursor.fetchall()

    column_names = [description[0] for description in cursor.description]

    with open(f"{table_name}.csv", "w", newline="", encoding="utf-8") as file:
        writer = csv.writer(file)
        writer.writerow(column_names)
        writer.writerows(rows)

    print(f"{table_name}.csv exported successfully")




# Function: Display Table in Tabular Format

def display_table(table_name):
    cursor.execute(f"SELECT * FROM {table_name}")
    rows = cursor.fetchall()
    column_names = [description[0] for description in cursor.description]

    print(f"\n================ {table_name.upper()} TABLE ================\n")



    # Calculate column widths
    col_widths = [len(col) for col in column_names]
    for row in rows:
        for i, value in enumerate(row):
            col_widths[i] = max(col_widths[i], len(str(value)))




    # Print header
    header = " | ".join(col.ljust(col_widths[i]) for i, col in enumerate(column_names))
    print(header)
    print("-" * len(header))



    # Print rows
    for row in rows:
        print(" | ".join(str(value).ljust(col_widths[i]) for i, value in enumerate(row)))

for table in tables:
    export_to_csv(table)
    display_table(table)

conn.close()
